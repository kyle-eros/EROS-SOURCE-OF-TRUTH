{
  "creationTime": "1756934906517",
  "etag": "XaOL38U9IDsdp7rkwGbbBw==",
  "id": "of-scheduler-proj:mart.v_weekly_template_audit",
  "kind": "bigquery#table",
  "lastModifiedTime": "1756934906517",
  "location": "US",
  "numActiveLogicalBytes": "0",
  "numBytes": "0",
  "numLongTermBytes": "0",
  "numLongTermLogicalBytes": "0",
  "numRows": "0",
  "numTotalLogicalBytes": "0",
  "schema": {
    "fields": [
      {
        "name": "username_std",
        "type": "STRING"
      },
      {
        "name": "scheduler_name",
        "type": "STRING"
      },
      {
        "name": "date_local",
        "type": "DATE"
      },
      {
        "name": "dow",
        "type": "INTEGER"
      },
      {
        "name": "ppv_quota",
        "type": "INTEGER"
      },
      {
        "name": "hour_pool",
        "type": "INTEGER"
      },
      {
        "name": "is_burst_dow",
        "type": "INTEGER"
      },
      {
        "name": "weight_volume",
        "type": "FLOAT"
      },
      {
        "name": "weight_hours",
        "type": "FLOAT"
      },
      {
        "name": "weight_price",
        "type": "FLOAT"
      },
      {
        "name": "exploration_rate",
        "type": "FLOAT"
      },
      {
        "name": "p35",
        "type": "FLOAT"
      },
      {
        "name": "p50",
        "type": "FLOAT"
      },
      {
        "name": "p60",
        "type": "FLOAT"
      },
      {
        "name": "p80",
        "type": "FLOAT"
      },
      {
        "name": "p90",
        "type": "FLOAT"
      },
      {
        "name": "price_mode",
        "type": "STRING"
      },
      {
        "name": "corr_price_rev",
        "type": "FLOAT"
      },
      {
        "name": "dow_score",
        "type": "FLOAT"
      },
      {
        "name": "slot_rank",
        "type": "INTEGER"
      },
      {
        "name": "hod_local",
        "type": "INTEGER"
      },
      {
        "name": "price_usd",
        "type": "FLOAT"
      },
      {
        "name": "planned_local_datetime",
        "type": "DATETIME"
      },
      {
        "name": "scheduled_datetime_utc",
        "type": "TIMESTAMP"
      }
    ]
  },
  "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/of-scheduler-proj/datasets/mart/tables/v_weekly_template_audit",
  "tableReference": {
    "datasetId": "mart",
    "projectId": "of-scheduler-proj",
    "tableId": "v_weekly_template_audit"
  },
  "type": "VIEW",
  "view": {
    "query": "WITH q AS (\n  SELECT * FROM `of-scheduler-proj.mart.v_daily_quota_policy_v3`\n),\nw AS (\n  SELECT username_std, weight_volume, weight_price, weight_hours, exploration_rate, updated_at\n  FROM `of-scheduler-proj.core.page_personalization_weights`\n),\ndow AS (  -- total DOW score for context\n  SELECT username_std, dow_local AS dow, SUM(score) AS dow_score\n  FROM `of-scheduler-proj.mart.v_mm_dow_hod_180d_local_v2`\n  GROUP BY username_std, dow_local\n),\npp AS (\n  SELECT username_std, p35, p50, p60, p80, p90, price_mode, corr_price_rev\n  FROM `of-scheduler-proj.mart.v_mm_price_profile_90d_v2`\n)\nSELECT\n  t.username_std,\n  t.scheduler_name,\n  t.date_local,\n  MOD(EXTRACT(DAYOFWEEK FROM t.date_local) + 5, 7) AS dow,  -- 0=Mon..6=Sun\n  q.ppv_quota,\n  q.hour_pool,\n  q.is_burst_dow,\n  w.weight_volume, w.weight_hours, w.weight_price, w.exploration_rate,\n  pp.p35, pp.p50, pp.p60, pp.p80, pp.p90, pp.price_mode, pp.corr_price_rev,\n  d.dow_score,\n  t.slot_rank,\n  t.hod_local,\n  t.price_usd,\n  t.planned_local_datetime,\n  t.scheduled_datetime_utc\nFROM `of-scheduler-proj.mart.weekly_template_7d_latest` t\nLEFT JOIN q  ON q.username_std = t.username_std\n            AND q.dow = MOD(EXTRACT(DAYOFWEEK FROM t.date_local) + 5, 7)\nLEFT JOIN w  ON w.username_std = t.username_std\nLEFT JOIN pp ON pp.username_std = t.username_std\nLEFT JOIN dow d ON d.username_std = t.username_std\n               AND d.dow = MOD(EXTRACT(DAYOFWEEK FROM t.date_local) + 5, 7)\nORDER BY t.username_std, t.date_local, t.slot_rank",
    "useLegacySql": false
  }
}
